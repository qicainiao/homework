<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script>
       function Promise(executor) {
            var self = this
            self.status = 'pending' // Promise当前的状态
            self.data = undefined  // Promise的值
            self.onResolvedCallback = [] // Promise resolve时的回调函数集，因为在Promise结束之前有可能有多个回调添加到它上面
            self.onRejectedCallback = [] // Promise reject时的回调函数集，因为在Promise结束之前有可能有多个回调添加到它上面

            function resolve(value) {
                if (value instanceof MyPromise) {
                    return value.then(resolve, reject)
                }
                setTimeout(() => {
                    if (that.state === PENDING) {
                    that.state = RESOLVED
                    that.value = value
                    that.resolvedCallbacks.map(cb => cb(that.value))
                    }
                }, 0)
            }

            function reject(value) {
                setTimeout(() => {
                    if (that.state === PENDING) {
                    that.state = REJECTED
                    that.value = value
                    that.rejectedCallbacks.map(cb => cb(that.value))
                    }
                }, 0)
            }
            try {
                fn(resolve, reject)
                } catch (e) {
                reject(e)
            }
        }

         MyPromise.prototype.then = function(onFulfilled, onRejected) {
            const that = this
            onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : v => v
            onRejected =
                typeof onRejected === 'function'
                ? onRejected
                : r => {
                    throw r
                    }
               if (that.state === PENDING) {
                    return (promise2 = new MyPromise((resolve, reject) => {
                        that.resolvedCallbacks.push(() => {
                        try {
                            const x = onFulfilled(that.value)
                            resolutionProcedure(promise2, x, resolve, reject)
                        } catch (r) {
                            reject(r)
                        }
                        })

                        that.rejectedCallbacks.push(() => {
                        try {
                            const x = onRejected(that.value)
                            resolutionProcedure(promise2, x, resolve, reject)
                        } catch (r) {
                            reject(r)
                        }
                        })
                    }))
               }

               if (that.state === RESOLVED) {
                    return (promise2 = new MyPromise((resolve, reject) => {
                        setTimeout(() => {
                        try {
                            const x = onFulfilled(that.value)
                            resolutionProcedure(promise2, x, resolve, reject)
                        } catch (reason) {
                            reject(reason)
                        }
                        })
                    }))
                }
         }
         new MyPromise((resolve, reject) => {
            setTimeout(() => {
                resolve(1)
            }, 0)
            }).then(value => {
            console.log("value==>",value)
          })

    </script>
</head>
<body>
    
</body>
</html>